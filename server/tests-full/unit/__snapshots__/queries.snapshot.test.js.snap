// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`query pipeline snapshots UT-QUERY-004 matches snapshot for standard filters 1`] = `
[
  {
    "$lookup": {
      "as": "brands",
      "foreignField": "_id",
      "from": "brands",
      "localField": "brand",
    },
  },
  {
    "$unwind": {
      "path": "$brands",
      "preserveNullAndEmptyArrays": true,
    },
  },
  {
    "$addFields": {
      "brand._id": "$brands._id",
      "brand.isActive": "$brands.isActive",
      "brand.name": "$brands.name",
      "brand.slug": "$brands.slug",
    },
  },
  {
    "$match": {
      "brand.isActive": true,
    },
  },
  {
    "$lookup": {
      "as": "reviews",
      "foreignField": "product",
      "from": "reviews",
      "localField": "_id",
    },
  },
  {
    "$addFields": {
      "totalRatings": {
        "$sum": "$reviews.rating",
      },
      "totalReviews": {
        "$size": "$reviews",
      },
    },
  },
  {
    "$addFields": {
      "averageRating": {
        "$cond": [
          {
            "$eq": [
              "$totalReviews",
              0,
            ],
          },
          0,
          {
            "$divide": [
              "$totalRatings",
              "$totalReviews",
            ],
          },
        ],
      },
    },
  },
  {
    "$match": {
      "averageRating": {
        "$gte": 4.5,
      },
      "isActive": true,
      "price": {
        "$gte": 50,
        "$lte": 200,
      },
    },
  },
  {
    "$project": {
      "brands": 0,
      "reviews": 0,
    },
  },
]
`;

exports[`query pipeline snapshots UT-QUERY-006 wishlist pipeline snapshot 1`] = `
[
  {
    "$lookup": {
      "as": "isLiked",
      "from": "wishlists",
      "let": {
        "product": "$_id",
      },
      "pipeline": [
        {
          "$match": {
            "$and": [
              {
                "$expr": {
                  "$eq": [
                    "$$product",
                    "$product",
                  ],
                },
              },
              {
                "user": mockConstructor {},
              },
            ],
          },
        },
      ],
    },
  },
  {
    "$addFields": {
      "isLiked": {
        "$arrayElemAt": [
          "$isLiked.isLiked",
          0,
        ],
      },
    },
  },
]
`;
